<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Admin - orders.html</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <header class="header">
        <div class="logo">Admin - Nhà Sách</div>
        <nav class="nav"><a href="../index.html">Về trang chính</a></nav>
    </header>
    <main class='container'>
        <h2>Đơn hàng</h2>
        <div id='admin-orders'>Danh sách đơn (placeholder)</div>
    </main>
    <footer class="footer">
        <p>© 2025 Admin</p>
    </footer>
    <script src="../assets/js/main.js"></script>

<!-- Admin orders manager injected -->
<script>
// Admin orders manager (uses localStorage users object)
(function(){
  const storage = { get(k,def){try{return JSON.parse(localStorage.getItem(k)) ?? def}catch(e){return def}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))} };
  let users = storage.get('users', {});
  const container = document.createElement('div');
  container.style.padding = '12px';
  container.innerHTML = '<h3>Quản lý đơn hàng (Admin)</h3>';
  const table = document.createElement('table'); table.style.width='100%'; table.style.borderCollapse='collapse';
  table.innerHTML = '<thead><tr><th>User</th><th>Order ID</th><th>Created</th><th>Items</th><th>Status</th><th>Hành động</th></tr></thead>';
  const tbody = document.createElement('tbody');
  Object.keys(users).forEach(u=>{
    (users[u].orders || []).forEach(o=>{
      const tr = document.createElement('tr'); tr.style.borderTop='1px solid #eef2f6';
      const items = (o.items||[]).map(it=>('ID:'+it.id+' x'+it.qty)).join('<br>');
      tr.innerHTML = `<td>${u}</td><td>${o.id}</td><td>${(new Date(o.created)).toLocaleString()}</td><td>${items}</td><td><select data-user="${u}" data-oid="${o.id}"><option>Đang giao</option><option>Đã hoàn thành</option><option>Đã hủy</option></select></td><td><button class="btn" data-user="${u}" data-oid="${o.id}">Lưu</button></td>`;
      setTimeout(()=>{ const sel = tr.querySelector('select'); sel.value = o.status; },0);
      tbody.appendChild(tr);
    });
  });
  table.appendChild(tbody);
  container.appendChild(table);
  document.body.prepend(container);

  container.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-oid]');
    if(!btn) return;
    const user = btn.getAttribute('data-user'), oid = btn.getAttribute('data-oid');
    const sel = container.querySelector('select[data-user="'+user+'"][data-oid="'+oid+'"]');
    if(!sel) return;
    const ns = sel.value;
    users = storage.get('users', {});
    if(users[user] && users[user].orders){
      users[user].orders = users[user].orders.map(o=> o.id == oid ? Object.assign({}, o, {status: ns}) : o );
      storage.set('users', users);
      alert('Đã cập nhật trạng thái đơn #'+oid+' thành: '+ns);
    } else alert('Không tìm thấy đơn.');
  });
})();
</script>
<!-- End injected script -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>