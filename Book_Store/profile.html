<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hồ sơ - Bookly</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>body{background:#f4f6f8;padding:0;margin:0} .profile-header{background:#fff;padding:18px;border-bottom:1px solid #eef2f6}</style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <header class="profile-header">
    <div class="container flex-between">
      <div style="display:flex;align-items:center;gap:12px"><img src="images/Logo.png" width="44" style="border-radius:8px"/><h2>Bookly</h2></div>
      <div><a href="index.html" class="btn">Về trang chủ</a></div>
    </div>
  </header>

  <main class="container">
    <h3>Hồ sơ của bạn: <span id="usernameDisplay"></span></h3>
    <div id="profileInfo" class="profile-info"></div>

    <section>
      <h4>Đơn hàng của bạn</h4>
      <div id="ordersContainer" class="orders-list"></div>
    </section>
  </main>

<script>
const storage = { get(k,def){try{return JSON.parse(localStorage.getItem(k)) ?? def}catch(e){return def}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))} };
let session = storage.get('session', null);
const users = storage.get('users', {});

function renderProfile(){
  const user = session;
  document.getElementById('usernameDisplay').textContent = user || '(chưa đăng nhập)';
  if(!user){ document.getElementById('profileInfo').innerHTML = '<a href="login.html" class="btn">Đăng nhập</a> <a href="register.html" class="btn ghost">Đăng ký</a>'; return; }
  const u = users[user] || {orders:[]};
  document.getElementById('profileInfo').innerHTML = '<div>Email: '+user+' (demo)</div>';
  const cont = document.getElementById('ordersContainer'); cont.innerHTML='';
  if(!u.orders || u.orders.length===0){ cont.innerHTML='<p>Bạn chưa có đơn hàng.</p>'; return; }
  u.orders.slice().reverse().forEach(o=>{
    const box = document.createElement('div'); box.className='order-box';
    const meta = document.createElement('div'); meta.className='order-meta';
    const left = document.createElement('div'); left.innerHTML = '<strong>Đơn #'+o.id+'</strong><div style="color:#6b7280">'+ (new Date(o.created)).toLocaleString() +'</div>';
    const right = document.createElement('div'); right.innerHTML = '<span class="status-badge status-'+o.status.replace(/\s/g,'\\ ')+'">'+o.status+'</span>';
    meta.appendChild(left); meta.appendChild(right);
    const items = document.createElement('div'); items.className='order-items';
    o.items.forEach(it=>{ const p = {title: 'Sản phẩm '+it.id}; items.innerHTML += '<div>- ID:'+it.id+' x'+it.qty+'</div>'; });
    box.appendChild(meta); box.appendChild(items);
    cont.appendChild(box);
  });
}

renderProfile();
</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
